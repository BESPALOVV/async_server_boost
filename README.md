Copied from sync_server, separated the accepting for clients, and clients handling, unlike sync_server version.
